{% extends "layouts/dashboard_page_view.html" %}
{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block page_description %}
    Welcome to your dashboard, <strong>{{ user.first_name }}</strong>!
{% endblock %}
{% block page_content %}
<div class="space-y-6">
    <!-- Top Stats -->
    <div class="grid grid-cols-2 gap-4">
        <!-- Matches -->
        <div class="bg-white dark:bg-zinc-800 p-4 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400 font-medium">Occupation Matches</p>
                <p class="text-xl font-bold text-zinc-900 dark:text-white mt-1">
                    {% if user.candidate %}
                        {{ user.candidate.occupation_matches_count }}
                    {% else %}
                        0
                    {% endif %}
                </p>
            </div>
            <div class="p-2 bg-primary/10 dark:bg-primary/20 rounded-lg text-primary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
            </div>
        </div>

        <!-- NQF Level -->
        <div class="bg-white dark:bg-zinc-800 p-4 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400 font-medium">Highest NQF Level</p>
                <p class="text-xl font-bold text-zinc-900 dark:text-white mt-1">
                     {% if user.candidate.highest_nqf_level %}
                        {{ user.candidate.highest_nqf_level }}
                    {% else %}
                        -
                    {% endif %}
                </p>
            </div>
            <div class="p-2 bg-secondary/10 dark:bg-secondary/20 rounded-lg text-secondary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"></path></svg>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 gap-6">
        <!-- Assessment Progress -->
        <div class="bg-white dark:bg-zinc-800 p-6 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm">
            <h3 class="text-lg font-semibold text-zinc-900 dark:text-white mb-4">Assessment Progress</h3>
            {% if user.candidate.assessment_progress %}
                <div class="space-y-6">
                    {% for ofo_code, data in user.candidate.assessment_progress.items %}
                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <div>
                                <h4 class="font-medium text-zinc-800 dark:text-zinc-200 text-sm">{{ data.title }}</h4>
                                <p class="text-xs text-zinc-500">Tasks: {{ data.answered }} of {{ data.total }}</p>
                            </div>
                            <span class="text-sm font-semibold 
                                {% if data.percentage >= 80 %}text-emerald-600 dark:text-emerald-400{% elif data.percentage >= 50 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {{ data.percentage }}%
                            </span>
                        </div>
                        <div class="w-full bg-zinc-100 dark:bg-zinc-700 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-1000 ease-out 
                                {% if data.percentage >= 80 %}bg-emerald-500{% elif data.percentage >= 50 %}bg-yellow-500{% else %}bg-red-500{% endif %}" 
                                style="width: {{ data.percentage }}%">
                            </div>
                        </div>
                        {% if data.percentage < 100 %}
                        <div class="mt-1 text-right">
                             <a href="{% url 'candidates:onboarding-assessment' %}" class="text-xs text-primary hover:text-primary/80 hover:underline">Continue Assessment &rarr;</a>
                        </div>
                        {% else %}
                         <div class="mt-1 text-right">
                             <span class="text-xs text-emerald-600 dark:text-emerald-400 flex items-center justify-end gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                Completed
                             </span>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <p class="text-zinc-500 mb-2">No assessments started yet.</p>
                    <a href="{% url 'candidates:onboarding' %}" class="btn btn-sm btn-outline">Start Onboarding</a>
                </div>
            {% endif %}
        </div>

        <!-- Occupational Proficiency -->
        <div class="bg-white dark:bg-zinc-800 p-6 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm">
            <h3 class="text-lg font-semibold text-zinc-900 dark:text-white mb-4">Occupational Proficiency</h3>
             {% if user.candidate.recommended_occupations %}
                <div class="space-y-6">
                    {% for item in user.candidate.recommended_occupations %}
                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <div>
                                <h4 class="font-medium text-zinc-800 dark:text-zinc-200 text-sm">{{ item.title }}</h4>
                                <p class="text-xs text-zinc-500 font-mono">{{ item.ofo_code }}</p>
                            </div>
                            <span class="text-sm font-semibold 
                                {% if item.score >= 80 %}text-emerald-600 dark:text-emerald-400{% elif item.score >= 50 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {{ item.score }}%
                            </span>
                        </div>
                        
                        <div class="w-full bg-zinc-100 dark:bg-zinc-700 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-1000 ease-out
                                {% if item.score >= 80 %}bg-emerald-500{% elif item.score >= 50 %}bg-yellow-500{% else %}bg-red-500{% endif %}" 
                                style="width: {{ item.score }}%">
                            </div>
                        </div>
                        
                        <div class="mt-1 text-right">
                            <span class="text-xs font-medium 
                                {% if item.score >= 80 %}text-emerald-600 dark:text-emerald-400{% elif item.score >= 50 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {% if item.score >= 80 %}
                                    High Proficiency
                                {% elif item.score >= 50 %}
                                    Moderate Proficiency
                                {% else %}
                                    Developing
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                 <div class="text-center py-8">
                    <p class="text-zinc-500 text-sm">Complete your assessments to see your proficiency scores.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
