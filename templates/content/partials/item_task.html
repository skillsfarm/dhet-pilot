<div x-data="{ editing: {{ start_editing|default:'false'|lower }} }" 
     class="item-container p-4 rounded-lg border border-border bg-card transition relative group"
     id="task-{{ task.id }}">
    
    <!-- View Mode -->
    <div x-show="!editing">
        <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
                <h4 class="font-semibold text-foreground text-sm">{{ task.title }}</h4>
                {% if task.description %}
                    <p class="text-sm text-muted-foreground mt-1 leading-relaxed">{{ task.description }}</p>
                {% endif %}
            </div>
            
            <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                 <button type="button" 
                        @click="editing = true" 
                        class="p-2 rounded-lg hover:bg-muted text-muted-foreground hover:text-primary transition"
                        title="Edit Task">
                    <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
                <button type="button" 
                        hx-delete="{% url 'occupation-task-detail' occupation.id task.id %}"
                        hx-target="#task-{{ task.id }}"
                        hx-swap="outerHTML"
                        hx-confirm="Are you sure you want to delete this task?"
                        class="p-2 rounded-lg hover:bg-muted text-muted-foreground hover:text-destructive transition"
                        title="Delete Task">
                     <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Mode -->
    <div x-show="editing" style="display: none;">
        <form method="post"
              action="{% url 'occupation-task-detail' occupation.id task.id %}"
              hx-post="{% url 'occupation-task-detail' occupation.id task.id %}"
              hx-target="#task-{{ task.id }}"
              hx-swap="outerHTML"
              x-data="{ isSubmitting: false }"
              @submit="isSubmitting = true">
            {% csrf_token %}
            
            <div class="space-y-4 mb-4">
                <div>
                    <label class="block mb-2 text-xs font-medium text-muted-foreground uppercase">Task Title</label>
                    <input type="text" 
                           name="title" 
                           value="{{ task.title }}" 
                           class="app-input" 
                           required>
                </div>
                <div>
                     <label class="block mb-2 text-xs font-medium text-muted-foreground uppercase">Description</label>
                    <textarea name="description" 
                              rows="3" 
                              class="app-input">{{ task.description }}</textarea>
                </div>
            </div>

            <div class="flex items-center justify-end gap-2">
                <button type="button" 
                        @click="editing = false" 
                        class="app-btn app-btn-ghost text-sm"
                        :disabled="isSubmitting">
                    Cancel
                </button>
                <button type="submit" 
                        class="app-btn app-btn-primary text-sm" 
                        :disabled="isSubmitting">
                     <span x-show="!isSubmitting">Save Changes</span>
                    <span x-show="isSubmitting" class="flex items-center gap-2">
                        <i data-lucide="loader" class="w-3 h-3 animate-spin-smooth"></i>
                        Saving...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>
