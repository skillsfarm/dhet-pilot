<!-- Work Experience Card -->
<div x-data="{ adding: false }" class="app-card space-y-6">
    {% include "components/card_header.html" with title="Work Experience" description="Manage your professional experience" %}
    <!-- List of existing experience -->
    <div class="space-y-4">
        {% for job in work_experience %}
            {% include "accounts/partials/item_experience.html" %}
        {% empty %}
            <div class="text-center py-8 border border-dashed border-border rounded-lg">
                <p class="text-muted-foreground">No work experience added yet.</p>
                <button type="button"
                        @click="adding = true"
                        class="mt-2 text-sm text-primary hover:underline">Add your first job</button>
            </div>
        {% endfor %}
    </div>
    <!-- Card Footer -->
    <div x-show="!adding"
         class="-mx-8 -mb-8 mt-6 px-8 py-4 bg-muted border-t border-border">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="text-sm text-muted-foreground">Add your work history to highlight your experience.</div>
            <button type="button"
                    @click="adding = true"
                    class="app-btn app-btn-primary w-full sm:w-auto flex items-center justify-center gap-2">
                <i data-lucide="plus" class="w-4 h-4"></i>
                Add Experience
            </button>
        </div>
    </div>
    <!-- Form to add new -->
    <div x-show="adding" class="pt-6 border-t border-border" x-transition>
        <div class="flex items-center justify-between mb-4">
            <h4 class="font-medium">Add Work Experience</h4>
            <button type="button"
                    @click="adding = false"
                    class="text-muted-foreground hover:text-foreground">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <form method="post"
              action="{% url 'profile-experience' %}"
              hx-post="{% url 'profile-experience' %}"
              hx-target="#tab-content"
              hx-swap="innerHTML swap:0.5s"
              x-data="{ isSubmitting: false, isCurrent: false }"
              @submit="isSubmitting = true"
              @htmx:afterRequest="isSubmitting = false"
              @htmx:responseError="isSubmitting = false">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="app-alert app-alert-error mb-4">
                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                    <div>{{ form.non_field_errors }}</div>
                </div>
            {% endif %}
            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.job_title.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-muted-foreground">Job Title</label>
                        <input type="text"
                               name="{{ form.job_title.name }}"
                               id="{{ form.job_title.id_for_label }}"
                               placeholder="e.g. Electrician"
                               class="app-input {% if form.job_title.errors %}border-destructive{% endif %}"
                               required>
                        {% if form.job_title.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.job_title.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div>
                        <label for="{{ form.company.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-muted-foreground">Company</label>
                        <input type="text"
                               name="{{ form.company.name }}"
                               id="{{ form.company.id_for_label }}"
                               placeholder="Company Name"
                               class="app-input {% if form.company.errors %}border-destructive{% endif %}"
                               required>
                        {% if form.company.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.company.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.start_date.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-muted-foreground">Start Date</label>
                        <input type="date"
                               name="{{ form.start_date.name }}"
                               id="{{ form.start_date.id_for_label }}"
                               class="app-input {% if form.start_date.errors %}border-destructive{% endif %}"
                               required>
                        {% if form.start_date.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.start_date.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label for="{{ form.end_date.id_for_label }}"
                                   class="text-sm font-medium text-muted-foreground">End Date</label>
                            <div class="flex items-center">
                                <input type="checkbox"
                                       id="current_job"
                                       x-model="isCurrent"
                                       class="mr-2 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary">
                                <label for="current_job"
                                       class="text-xs text-muted-foreground cursor-pointer">Current Job</label>
                            </div>
                        </div>
                        <input type="date"
                               name="{{ form.end_date.name }}"
                               id="{{ form.end_date.id_for_label }}"
                               class="app-input {% if form.end_date.errors %}border-destructive{% endif %}"
                               :disabled="isCurrent"
                               :required="!isCurrent">
                        {% if form.end_date.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.end_date.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 mt-6">
                <button type="button" @click="adding = false" class="app-btn app-btn-ghost">Cancel</button>
                <button type="submit"
                        class="app-btn app-btn-primary"
                        :disabled="isSubmitting">
                    <span x-show="!isSubmitting">Save Experience</span>
                    <span x-show="isSubmitting" class="flex items-center gap-2">
                        <i data-lucide="loader" class="w-4 h-4 animate-spin-smooth"></i>
                        Saving...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>
