<div x-data="{ editing: false }" class="item-container p-4 rounded-lg border border-border bg-card transition" :class="{ 'hover:bg-accent/50': !editing }">
    <!-- View Mode -->
    <div x-show="!editing">
        <div class="flex items-start justify-between gap-4">
             <div>
                <h4 class="font-semibold text-foreground">{{ job.job_title }}</h4>
                <div class="text-sm text-foreground/80 mt-1">
                    {{ job.company }}
                </div>
                <div class="flex items-center gap-2 mt-2 text-xs text-muted-foreground">
                    <i data-lucide="calendar" class="w-3 h-3"></i>
                    <span>{{ job.start_date|date:"M Y" }} - {% if job.end_date %}{{ job.end_date|date:"M Y" }}{% else %}Present{% endif %}</span>
                    <span class="mx-1">â€¢</span>
                    <span>{{ job.years_experience }} years</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                 <button type="button" @click="editing = true" class="p-2 rounded-full hover:bg-muted text-muted-foreground hover:text-primary transition">
                    <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Mode -->
    <div x-show="editing" style="display: none;">
        <form method="post"
              action="{% url 'profile-experience-detail' pk=job.pk %}"
              hx-post="{% url 'profile-experience-detail' pk=job.pk %}"
              hx-target="closest .item-container"
              hx-swap="outerHTML"
               x-data="{ isSubmitting: false, isCurrent: {% if not job.end_date %}true{% else %}false{% endif %} }"
              @submit="isSubmitting = true">
              
            <div class="space-y-4 mb-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-muted-foreground">Job Title</label>
                        <input type="text" name="job_title" value="{{ job.job_title }}" class="app-input" required>
                    </div>
                     <div>
                        <label class="block mb-2 text-sm font-medium text-muted-foreground">Company</label>
                        <input type="text" name="company" value="{{ job.company }}" class="app-input" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-muted-foreground">Start Date</label>
                        <input type="date" name="start_date" value="{{ job.start_date|date:'Y-m-d' }}" class="app-input" required>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-2">
                             <label class="text-sm font-medium text-muted-foreground">End Date</label>
                             <div class="flex items-center">
                                <input type="checkbox" x-model="isCurrent" class="mr-2 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary">
                                <label class="text-xs text-muted-foreground cursor-pointer" @click="isCurrent = !isCurrent">Current Job</label>
                             </div>
                        </div>
                        <input type="date" name="end_date" value="{{ job.end_date|date:'Y-m-d' }}" class="app-input" :disabled="isCurrent" :required="!isCurrent">
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-between">
                <button type="button" 
                        hx-delete="{% url 'profile-experience-detail' pk=job.pk %}" 
                        hx-target="closest .item-container" 
                        hx-confirm="Are you sure you want to delete this work experience?"
                        class="app-btn app-btn-ghost text-destructive hover:bg-destructive/10">
                    Delete
                </button>
                <div class="flex items-center gap-2">
                    <button type="button" @click="editing = false" class="app-btn app-btn-ghost">Cancel</button>
                    <button type="submit" class="app-btn app-btn-primary" :disabled="isSubmitting">
                         <span x-show="!isSubmitting">Save</span>
                        <span x-show="isSubmitting">Saving...</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
