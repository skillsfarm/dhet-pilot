<!-- Education History Card -->
<div x-data="{ adding: false }" class="app-card space-y-6">
    {% include "components/card_header.html" with title="Education History" description="Manage your educational background" %}
    
    <!-- List of existing education -->
    <div class="space-y-4">
        {% for edu in education_history %}
            {% include "accounts/partials/item_education.html" %}
        {% empty %}
            <div class="text-center py-8 border border-dashed border-border rounded-lg">
                <p class="text-muted-foreground">No education history added yet.</p>
                <button type="button" @click="adding = true" class="mt-2 text-sm text-primary hover:underline">
                    Add your first qualification
                </button>
            </div>
        {% endfor %}
    </div>

    <!-- Card Footer -->
    <div x-show="!adding" class="-mx-8 -mb-8 mt-6 px-8 py-4 bg-muted border-t border-border">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="text-sm text-muted-foreground">
                Add details about your educational background.
            </div>
            <button type="button" @click="adding = true" class="app-btn app-btn-primary w-full sm:w-auto flex items-center justify-center gap-2">
                <i data-lucide="plus" class="w-4 h-4"></i>
                Add Education
            </button>
        </div>
    </div>

    <!-- Form to add new -->
    <div x-show="adding" class="pt-6 border-t border-border" x-transition>
        <div class="flex items-center justify-between mb-4">
            <h4 class="font-medium">Add Qualification</h4>
            <button type="button" @click="adding = false" class="text-muted-foreground hover:text-foreground">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        
        <form method="post"
              action="{% url 'profile-education' %}"
              hx-post="{% url 'profile-education' %}"
              hx-target="#tab-content"
              hx-swap="innerHTML swap:0.5s"
              x-data="{ isSubmitting: false, educationType: '' }"
              @submit="isSubmitting = true"
              @htmx:afterRequest="isSubmitting = false"
              @htmx:responseError="isSubmitting = false">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div class="app-alert app-alert-error mb-4">
                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                    <div>{{ form.non_field_errors }}</div>
                </div>
            {% endif %}

            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        {% include "components/select.html" with name=form.education_type.name label="Education Type" options=form.education_type.field.choices value=form.education_type.value use_tuple=True x_model="educationType" placeholder="Select type" %}
                        {% if form.education_type.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.education_type.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <div>
                        <label for="{{ form.year_completed.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-muted-foreground">Year Completed</label>
                        <input type="number"
                               name="{{ form.year_completed.name }}"
                               id="{{ form.year_completed.id_for_label }}"
                               placeholder="e.g. 2020"
                               class="app-input {% if form.year_completed.errors %}border-destructive{% endif %}"
                               required>
                        {% if form.year_completed.errors %}
                            <ul class="mt-2 text-sm font-medium text-destructive list-none">
                                {% for error in form.year_completed.errors %}<li>{{ error }}</li>{% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>

                <div>
                    <label for="{{ form.institution.id_for_label }}"
                           class="block mb-2 text-sm font-medium text-muted-foreground">Institution</label>
                    <input type="text"
                           name="{{ form.institution.name }}"
                           id="{{ form.institution.id_for_label }}"
                           placeholder="Name of school, college or university"
                           class="app-input {% if form.institution.errors %}border-destructive{% endif %}"
                           required>
                    {% if form.institution.errors %}
                        <ul class="mt-2 text-sm font-medium text-destructive list-none">
                            {% for error in form.institution.errors %}<li>{{ error }}</li>{% endfor %}
                        </ul>
                    {% endif %}
                </div>

                <div x-show="educationType !== 'MATRIC'" x-transition>
                    <label for="{{ form.field_of_study.id_for_label }}"
                           class="block mb-2 text-sm font-medium text-muted-foreground">Field of Study / Qualification Name</label>
                    <input type="text"
                           name="{{ form.field_of_study.name }}"
                           id="{{ form.field_of_study.id_for_label }}"
                           placeholder="e.g. Electrical Engineering"
                           class="app-input {% if form.field_of_study.errors %}border-destructive{% endif %}"
                           :required="educationType !== 'MATRIC'">
                    {% if form.field_of_study.errors %}
                        <ul class="mt-2 text-sm font-medium text-destructive list-none">
                            {% for error in form.field_of_study.errors %}<li>{{ error }}</li>{% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            <div class="flex items-center justify-end gap-3 mt-6">
                <button type="button" @click="adding = false" class="app-btn app-btn-ghost">
                    Cancel
                </button>
                <button type="submit"
                        class="app-btn app-btn-primary"
                        :disabled="isSubmitting">
                    <span x-show="!isSubmitting">Save Education</span>
                    <span x-show="isSubmitting" class="flex items-center gap-2">
                        <i data-lucide="loader" class="w-4 h-4 animate-spin-smooth"></i>
                        Saving...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>
